"use strict";function Vnode$1(e,t,n,r,i,o){return{tag:e,key:t,attrs:n,children:r,text:i,dom:o,domSize:void 0,state:{},events:void 0,instance:void 0,skip:!1}}function hyperscript$1(e){var t=arguments;if(null==e||"string"!=typeof e&&null==e.view)throw Error("The selector must be either a string or a component.");if("string"==typeof e&&void 0===selectorCache[e]){for(var n,r,i=[],o={};n=selectorParser.exec(e);){var a=n[1],s=n[2];if(""===a&&""!==s)r=s;else if("#"===a)o.id=s;else if("."===a)i.push(s);else if("["===n[3][0]){var u=n[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),o[n[4]]=u||!0}}i.length>0&&(o.className=i.join(" ")),selectorCache[e]=function(e,t){var n,i,a=!1,s=e.className||e.class;for(var u in o)e[u]=o[u];void 0!==s&&(void 0!==e.class&&(e.class=void 0,e.className=s),void 0!==o.className&&(e.className=o.className+" "+s));for(var u in e)if("key"!==u){a=!0;break}return t instanceof Array&&1==t.length&&null!=t[0]&&"#"===t[0].tag?i=t[0].children:n=t,Vnode(r||"div",e.key,a?e:void 0,n,i,void 0)}}var l,c,f;if(null!=arguments[1]&&("object"!=typeof arguments[1]||void 0!==arguments[1].tag||arguments[1]instanceof Array)?f=1:(l=arguments[1],f=2),arguments.length===f+1)c=arguments[f]instanceof Array?arguments[f]:[arguments[f]];else{c=[];for(var d=f;d<arguments.length;d++)c.push(t[d])}return"string"==typeof e?selectorCache[e](l||{},Vnode.normalizeChildren(c)):Vnode(e,l&&l.key,l||{},Vnode.normalizeChildren(c),void 0,void 0)}function findInCart(e,t){for(var n,r=!1,i=0;!r&&i<e.products.length;)n=e.products[i++],n.id===t&&(r=n);return r}Vnode$1.normalize=function(e){return e instanceof Array?Vnode$1("[",void 0,void 0,Vnode$1.normalizeChildren(e),void 0,void 0):null!=e&&"object"!=typeof e?Vnode$1("#",void 0,void 0,e,void 0,void 0):e},Vnode$1.normalizeChildren=function(e){for(var t=0;t<e.length;t++)e[t]=Vnode$1.normalize(e[t]);return e};var vnode=Vnode$1,Vnode=vnode,selectorParser=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,selectorCache={},hyperscript_1$2=hyperscript$1,Vnode$2=vnode,trust=function(e){return null==e&&(e=""),Vnode$2("<",void 0,void 0,e,void 0,void 0)},Vnode$3=vnode,fragment=function(e,t){return Vnode$3("[",e.key,e,Vnode$3.normalizeChildren(t),void 0,void 0)},hyperscript=hyperscript_1$2;hyperscript.trust=trust,hyperscript.fragment=fragment;var hyperscript_1=hyperscript,stream$2=function(e){function t(){function e(){return arguments.length>0&&arguments[0]!==O&&r(e,arguments[0],void 0),e._state.value}return n(e),arguments.length>0&&arguments[0]!==O&&r(e,arguments[0],void 0),e}function n(e){e.constructor=t,e._state={id:A++,value:void 0,error:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],errorStream:void 0,endStream:void 0},e["fantasy-land/map"]=_,e["fantasy-land/ap"]=y,e["fantasy-land/of"]=t,e.valueOf=b,e.to
  =w,e.toString=b,e.run=f,e.catch=d,Object.defineProperties(e,{error:{get:function(){if(!e._state.errorStream){var t=function(){return arguments.length>0&&arguments[0]!==O&&r(e,void 0,arguments[0]),e._state.error};n(t),p(t,[e],P,P),e._state.errorStream=t}return e._state.errorStream}},end:{get:function(){if(!e._state.endStream){var n=t();n["fantasy-land/map"](function(t){return t===!0&&(g(e),g(n)),t}),e._state.endStream=n}return e._state.endStream}}})}function r(e,t,n){i(e,t,n);for(var r in e._state.deps)a(e._state.deps[r],!1);l(e)}function i(e,t,n){if(n=u(t,n),void 0!==n&&"function"==typeof e._state.recover){if(!s(e,o,!0))return}else o(e,t,n);e._state.changed=!0,2!==e._state.state&&(e._state.state=1)}function o(e,t,n){e._state.value=t,e._state.error=n}function a(e,t){var n=e._state,r=n.parents;if(r.length>0&&r.filter($).length===r.length&&(t||r.filter(k).length>0)){var o=r.filter(C);o.length>0?i(e,void 0,o[0]._state.error):s(e,i,!1)}}function s(e,t,n){try{var r=n?e._state.recover():e._state.derive();if(r===O)return!1;t(e,r,void 0)}catch(n){t(e,void 0,null!=n.__error?n.__error:n),null==n.__error&&c(e,n)}return!0}function u(e,n){return null!=e&&e.constructor===t&&(n=void 0!==e._state.error?e._state.error:u(e._state.value,e._state.error)),n}function l(e){e._state.changed=!1;for(var t in e._state.deps)e._state.deps[t]._state.changed=!1}function c(t,n){0===Object.keys(t._state.deps).length&&setTimeout(function(){0===Object.keys(t._state.deps).length&&e(n)},0)}function f(e){var n=t(),r=this;return p(n,[r],function(){return h(n,e(r()))},void 0)}function d(e){var n=t(),r=this,i=function(){return r._state.value},o=function(){return h(n,e(r._state.error))};return p(n,[r],i,o)}function v(e,n){if(n.length>n.filter(x).length)throw new Error("Ensure that each item passed to m.prop.combine/m.prop.merge is a stream");return p(t(),n,function(){var t=n.filter(C);if(t.length>0)throw{__error:t[0]._state.error};return e.apply(this,n.concat([n.filter(k)]))},void 0)}function h(e,n){if(null!=n&&n.constructor===t){var r=n,o=function(){i(e,r._state.value,r._state.error);for(var t in e._state.deps)a(e._state.deps[t],!1)};if(r["fantasy-land/map"](o).catch(function(e){throw o(),{__error:e}}),0===r._state.state)return O;if(r._state.error)throw{__error:r._state.error};n=r._state.value}return n}function p(e,t,n,r){var i=e._state;return i.derive=n,i.recover=r,i.parents=t.filter(S),m(e,i.parents),a(e,!0),e}function m(e,t){for(var n=0;n<t.length;n++)t[n]._state.deps[e._state.id]=e,m(e,t[n]._state.parents)}function g(e){for(var t=0;t<e._state.parents.length;t++){var n=e._state.parents[t];delete n._state.deps[e._state.id]}for(var r in e._state.deps){var i=e._state.deps[r],o=i._state.parents.indexOf(e);o>-1&&i._state.parents.splice(o,1)}e._state.state=2,e._state.deps={}}function _(e){return v(function(t){return e(t())},[this])}function y(e){return v(function(e,t){return e()(t())},[e,this])}function b(){return this._state.value}function w(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function x(e){return e._state}function $(e){return 1===e._state.state}function k(e){return e._state.changed}function S(e){return 2!==e._state.state}function C(e){return e._state.error}function z(e){var n=t();return n.error(e),n}function E(e){return v(function(){return e.map(function(e){return e()})},e)}var A=0,P=function(){},O={};return t["fantasy-land/of"]=t,t.merge=E,t.combine=v,t.reject=z,t.HALT=O,t},stream=stream$2(console.log.bind(console)),build=function(e){function t(e,r){if(r instanceof Array)for(var i=0;i<r.length;i++)t(e+"["+i+"]",r[i]);else if("[object Object]"===Object.prototype.toString.call(r))for(var i in r)t(e+"["+i+"]",r[i]);else n.push(encodeURIComponent(e)+(null!=r&&""!==r?"="+encodeURIComponent(r):""))}if("[object Object]"!==Object.prototype.toString.call(e))return"";var n=[];for(var r in e)t(r,e[r]);return n.join("&")},buildQueryString=build,request$2=function(e,t){function n(e){c=e}function r(n){var r=t();void 0!==n.initialValue&&r(n.initialValue);var i="boolean"==typeof n.useBody?n.useBody:"GET"!==n.method&&"TRACE"!==n.method;"function"!=typeof n.serialize&&(n.serialize="undefined"!=typeof FormData&&n.data instanceof FormData?function(e){return e}:JSON.stringify),"function"!=typeof n.deserialize&&(n.deserialize=s),"function"!=typeof n.extract&&(n.extract=u),n.url=o(n.url,n.data),i?n.data=n.serialize(n.data):n.url=a(n.url,n.data);var f=new e.XMLHttpRequest;return f.open(n.method,n.url,"boolean"!=typeof n.async||n.async,"string"==typeof n.user?n.user:void 0,"string"==typeof n.password?n.password:void 0),n.serialize===JSON.stringify&&i&&f.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize===s&&f.setRequestHeader("Accept","application/json, text/*"),"function"==typeof n.config&&(f=n.config(f,n)||f),f.onreadystatechange=function(){if(4===f.readyState){try{var e=n.extract!==u?n.extract(f,n):n.deserialize(n.extract(f,n));if(f.status>=200&&f.status<300||304===f.status)r(l(n.type,e));else{var t=new Error(f.responseText);for(var i in e)t[i]=e[i];r.error(t)}}catch(e){r.error(e)}"function"==typeof c&&c()}},i?f.send(n.data):f.send(),r}function i(n){var r=t();void 0!==n.initialValue&&r(n.initialValue);var i=n.callbackName||"_mithril_"+Math.round(1e16*Math.random())+"_"+f++,s=e.document.createElement("script");return e[i]=function(t){s.parentNode.removeChild(s),r(l(n.type,t)),"function"==typeof c&&c(),delete e[i]},s.onerror=function(){s.parentNode.removeChild(s),r.error(new Error("JSONP request failed")),"function"==typeof c&&c(),delete e[i]},null==n.data&&(n.data={}),n.url=o(n.url,n.data),n.data[n.callbackKey||"callback"]=i,s.src=a(n.url,n.data),e.document.documentElement.appendChild(s),r}function o(e,t){if(null==t)return e;for(var n=e.match(/:[^\/]+/gi)||[],r=0;r<n.length;r++){var i=n[r].slice(1);null!=t[i]&&(e=e.replace(n[r],t[i]),delete t[i])}return e}function a(e,t){var n=buildQueryString(t);if(""!==n){var r=e.indexOf("?")<0?"?":"&";e+=r+n}return e}function s(e){try{return""!==e?JSON.parse(e):null}catch(t){throw new Error(e)}}function u(e){return e.responseText}function l(e,t){if("function"==typeof e){if(!(t instanceof Array))return new e(t);for(var n=0;n<t.length;n++)t[n]=new e(t[n])}return t}var c,f=0;return{request:r,jsonp:i,setCompletionCallback:n}},Stream=stream,request=request$2(window,Stream),pubsub=function(){function e(e){var t=n.indexOf(e);t>-1&&n.splice(t,1)}function t(){for(var e=arguments,t=this,r=0;r<n.length;r++)n[r].apply(t,e)}var n=[];return{subscribe:n.push.bind(n),unsubscribe:e,publish:t}},redraw=pubsub(),Vnode$4=vnode,render$2=function(e){function t(e){return I=e}function n(e,t,n,i,o,a,s){for(var u=n;u<i;u++){var l=t[u];null!=l&&b(e,r(l,o,s),a)}}function r(e,t,n){var r=e.tag;if(null!=e.attrs&&T(e.attrs,e,t),"string"!=typeof r)return u(e,t,n);switch(r){case"#":return i(e);case"<":return o(e);case"[":return a(e,t,n);default:return s(e,t,n)}}function i(e){return e.dom=q.createTextNode(e.children)}function o(e){var t=e.children.match(/^\s*?<(\w+)/im)||[],n={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"}[t[1]]||"div",r=q.createElement(n);r.innerHTML=e.children,e.dom=r.firstChild,e.domSize=r.childNodes.length;for(var i,o=q.createDocumentFragment();i=r.firstChild;)o.appendChild(i);return o}function a(e,t,r){var i=q.createDocumentFragment();if(null!=e.children){var o=e.children;n(i,o,0,o.length,t,null,r)}return e.dom=i.firstChild,e.domSize=i.childNodes.length,i}function s(e,t,r){var i=e.tag;switch(e.tag){case"svg":r="http://www.w3.org/2000/svg";break;case"math":r="http://www.w3.org/1998/Math/MathML"}var o=e.attrs,a=o&&o.is,s=r?a?q.createElementNS(r,i,{is:a}):q.createElementNS(r,i):a?q.createElement(i,{is:a}):q.createElement(i);if(e.dom=s,null!=o&&S(e,o,r),null!=e.text&&(""!==e.text?s.textContent=e.text:e.children=[Vnode$4("#",void 0,void 0,e.text,void 0,void 0)]),null!=e.children){var u=e.children;n(s,u,0,u.length,t,null,r),z(e)}return s}function u(e,t,n){if(e.state||(e.state={}),V(e.state,e.tag),T(e.tag,e,t),e.instance=Vnode$4.normalize(e.tag.view.call(e.state,e)),null!=e.instance){if(e.instance===e)throw Error("A view cannot return the vnode it received as arguments");var i=r(e.instance,t,n);return e.dom=e.instance.dom,e.domSize=null!=e.dom?e.instance.domSize:0,i}return e.domSize=0,M}function l(e,t,i,o,a,s){if(t!==i&&(null!=t||null!=i))if(null==t)n(e,i,0,i.length,o,a,void 0);else if(null==i)w(e,t,0,t.length,i);else{var u=m(t,i);if(u&&(t=t.concat(t.pool)),t.length===i.length&&null!=i[0]&&null==i[0].key)for(var l=0;l<t.length;l++)t[l]===i[l]||null==t[l]&&null==i[l]||(null==t[l]?b(e,r(i[l],o,s),y(t,l+1,a)):null==i[l]?w(e,t,l,l+1,i):c(e,t[l],i[l],o,y(t,l+1,a),u,s),u&&t[l].tag===i[l].tag&&b(e,_(t[l]),y(t,l+1,a)));else{for(var f,d=0,v=0,h=t.length-1,p=i.length-1;h>=d&&p>=v;){var x=t[d],$=i[v];if(x!==$||u)if(null!=x&&null!=$&&x.key===$.key)d++,v++,c(e,x,$,o,y(t,d,a),u,s),u&&x.tag===$.tag&&b(e,_(x),a);else{var x=t[h];if(x!==$||u){if(null==x||null==$||x.key!==$.key)break;c(e,x,$,o,y(t,h+1,a),u,s),(u||v<p)&&b(e,_(x),y(t,d,a)),h--,v++}else h--,v++}else d++,v++}for(;h>=d&&p>=v;){var x=t[h],$=i[p];if(x!==$||u)if(null!=x&&null!=$&&x.key===$.key)c(e,x,$,o,y(t,h+1,a),u,s),u&&x.tag===$.tag&&b(e,_(x),a),null!=x.dom&&(a=x.dom),h--,p--;else{if(f||(f=g(t,h)),null!=$){var k=f[$.key];if(null!=k){var S=t[k];c(e,S,$,o,y(t,h+1,a),u,s),b(e,_(S),a),t[k].skip=!0,null!=S.dom&&(a=S.dom)}else{var C=r($,o,void 0);b(e,C,a),a=C}}p--}else h--,p--;if(p<v)break}n(e,i,v,p+1,o,a,s),w(e,t,d,h+1,i)}}}function c(e,t,n,i,o,a,s){var u=t.tag,l=n.tag;if(u===l){if(n.state=t.state,n.events=t.events,L(n,t))return;if(null!=n.attrs&&F(n.attrs,n,i,a),"string"==typeof u)switch(u){case"#":f(t,n);break;case"<":d(e,t,n,o);break;case"[":v(e,t,n,i,o,s);break;default:h(t,n,i,s)}else p(e,t,n,i,o,a,s)}else $(e,t,null),b(e,r(n,i,void 0),o)}function f(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function d(e,t,n,r){t.children!==n.children?(_(t),b(e,o(n),r)):(n.dom=t.dom,n.domSize=t.domSize)}function v(e,t,n,r,i,o){l(e,t.children,n.children,r,i,o);var a=0,s=n.children;if(n.dom=null,null!=s){for(var u=0;u<s.length;u++){var c=s[u];null!=c&&null!=c.dom&&(null==n.dom&&(n.dom=c.dom),a+=c.domSize||1)}1!==a&&(n.domSize=a)}}function h(e,t,n,r){var i=t.dom=e.dom;switch(t.tag){case"svg":r="http://www.w3.org/2000/svg";break;case"math":r="http://www.w3.org/1998/Math/MathML"}"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),E(t,e.attrs,t.attrs,r),null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[Vnode$4("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[Vnode$4("#",void 0,void 0,t.text,void 0,void 0)]),l(i,e.children,t.children,n,null,r))}function p(e,t,n,i,o,a,s){n.instance=Vnode$4.normalize(n.tag.view.call(n.state,n)),F(n.tag,n,i,a),null!=n.instance?(null==t.instance?b(e,r(n.instance,i,s),o):c(e,t.instance,n.instance,i,o,a,s),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?($(e,t.instance,null),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function m(e,t){if(null!=e.pool&&Math.abs(e.pool.length-t.length)<=Math.abs(e.length-t.length)){var n=e[0]&&e[0].children&&e[0].children.length||0,r=e.pool[0]&&e.pool[0].children&&e.pool[0].children.length||0,i=t[0]&&t[0].children&&t[0].children.length||0;if(Math.abs(r-i)<=Math.abs(n-i))return!0}return!1}function g(e,t){for(var n={},r=0,r=0;r<t;r++){var i=e[r];if(null!=i){var o=i.key;null!=o&&(n[o]=r)}}return n}function _(e){var t=e.domSize;if(null!=t||null==e.dom){var n=q.createDocumentFragment();if(t>0){for(var r=e.dom;--t;)n.appendChild(r.nextSibling);n.insertBefore(r,n.firstChild)}return n}return e.dom}function y(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function b(e,t,n){n&&n.parentNode?e.insertBefore(t,n):e.appendChild(t)}function w(e,t,n,r,i){for(var o=n;o<r;o++){var a=t[o];null!=a&&(a.skip?a.skip=!1:$(e,a,i))}}function x(e){var t=!1;return function(){t||(t=!0,e())}}function $(e,t,n){function r(){if(++o===i&&(k(t),t.dom)){var r=t.domSize||1;if(r>1)for(var a=t.dom;--r;)e.removeChild(a.nextSibling);null!=t.dom.parentNode&&e.removeChild(t.dom),null==n||null!=t.domSize||U(t.attrs)||"string"!=typeof t.tag||(n.pool?n.pool.push(t):n.pool=[t])}}var i=1,o=0;t.attrs&&t.attrs.onbeforeremove&&(i++,t.attrs.onbeforeremove.call(t.state,t,x(r))),"string"!=typeof t.tag&&t.tag.onbeforeremove&&(i++,t.tag.onbeforeremove.call(t.state,t,x(r))),r()}function k(e){if(e.attrs&&e.attrs.onremove&&e.attrs.onremove.call(e.state,e),"string"!=typeof e.tag&&e.tag.onremove&&e.tag.onremove.call(e.state,e),null!=e.instance)k(e.instance);else{var t=e.children;if(t instanceof Array)for(var n=0;n<t.length;n++){var r=t[n];null!=r&&k(r)}}}function S(e,t,n){for(var r in t)C(e,r,null,t[r],n)}function C(e,t,n,r,i){var o=e.dom;if("key"!==t&&(n!==r||A(e,t)||"object"==typeof r)&&"undefined"!=typeof r&&!P(t)){var a=t.indexOf(":");if(a>-1&&"xlink"===t.substr(0,a))o.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(a+1),r);else if("o"===t[0]&&"n"===t[1]&&"function"==typeof r)j(e,t,r);else if("style"===t)N(o,n,r);else if(t in o&&!O(t)&&void 0===i){if("input"===e.tag&&"value"===t&&e.dom.value===r&&e.dom===q.activeElement)return;o[t]=r}else"boolean"==typeof r?r?o.setAttribute(t,""):o.removeAttribute(t):o.setAttribute("className"===t?"class":t,r)}}function z(e){var t=e.attrs;"select"===e.tag&&null!=t&&("value"in t&&C(e,"value",null,t.value,void 0),"selectedIndex"in t&&C(e,"selectedIndex",null,t.selectedIndex,void 0))}function E(e,t,n,r){if(null!=n)for(var i in n)C(e,i,t&&t[i],n[i],r);if(null!=t)for(var i in t)null!=n&&i in n||("className"===i&&(i="class"),"o"!==i[0]||"n"!==i[1]||P(i)?"key"!==i&&e.dom.removeAttribute(i):j(e,i,void 0))}function A(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===q.activeElement}function P(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function O(e){return"href"===e||"list"===e||"form"===e||"width"===e||"height"===e}function U(e){return null!=e&&(e.oncreate||e.onupdate||e.onbeforeremove||e.onremove)}function N(e,t,n){if(t===n&&(e.style.cssText="",t=null),null==n)e.style.cssText="";else if("string"==typeof n)e.style.cssText=n;else{"string"==typeof t&&(e.style.cssText="");for(var r in n)e.style[r]=n[r];if(null!=t&&"string"!=typeof t)for(var r in t)r in n||(e.style[r]="")}}function j(e,t,n){var r=e.dom,i=function(e){var t=n.call(r,e);return"function"==typeof I&&I.call(r,e),t};if(t in r)r[t]=i;else{var o=t.slice(2);void 0===e.events&&(e.events={}),null!=e.events[t]&&r.removeEventListener(o,e.events[t],!1),"function"==typeof n&&(e.events[t]=i,r.addEventListener(o,e.events[t],!1))}}function T(e,t,n){"function"==typeof e.oninit&&e.oninit.call(t.state,t),"function"==typeof e.oncreate&&n.push(e.oncreate.bind(t.state,t))}function F(e,t,n,r){r?T(e,t,n):"function"==typeof e.onupdate&&n.push(e.onupdate.bind(t.state,t))}function L(e,t){var n,r;return null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate&&(n=e.attrs.onbeforeupdate.call(e.state,e,t)),"string"!=typeof e.tag&&"function"==typeof e.tag.onbeforeupdate&&(r=e.tag.onbeforeupdate.call(e.state,e,t)),!(void 0===n&&void 0===r||n||r)&&(e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,!0)}function V(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function R(e,t){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var n=[],r=q.activeElement;null==e.vnodes&&(e.textContent=""),t instanceof Array||(t=[t]),l(e,e.vnodes,Vnode$4.normalizeChildren(t),n,null,void 0),e.vnodes=t;for(var i=0;i<n.length;i++)n[i]();q.activeElement!==r&&r.focus()}var I,q=e.document,M=q.createDocumentFragment();return{render:R,setEventCallback:t}},render=render$2(window),throttle$1=function(e){var t=16,n=0,r=null,i="function"==typeof requestAnimationFrame?requestAnimationFrame:setTimeout;return function(o){var a=Date.now();o===!0||0===n||a-n>=t?(n=a,e()):null===r&&(r=i(function(){r=null,e(),n=Date.now()},t-(a-n)))}},throttle=throttle$1,autoredraw$1=function(e,t,n,r){var i=throttle(r);return null!=t&&t.setEventCallback(function(e){e.redraw!==!1&&n.publish()}),null!=n&&(e.redraw&&n.unsubscribe(e.redraw),n.subscribe(i)),e.redraw=i},Vnode$5=vnode,autoredraw=autoredraw$1,mount$2=function(e,t){return function(n,r){if(null===r)return e.render(n,[]),t.unsubscribe(n.redraw),void delete n.redraw;if(null==r.view)throw new Error("m.mount(element, component) expects a component, not a vnode");var i=autoredraw(n,e,t,function(){e.render(n,Vnode$5(r,void 0,void 0,void 0,void 0,void 0))});i()}},renderService=render,redrawService$1=redraw,mount=mount$2(renderService,redrawService$1),parse=function(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));for(var t=e.split("&"),n={},r={},i=0;i<t.length;i++){var o=t[i].split("="),a=decodeURIComponent(o[0]),s=2===o.length?decodeURIComponent(o[1]):"";"true"===s?s=!0:"false"===s&&(s=!1);var u=a.split(/\]\[?|\[/),l=n;a.indexOf("[")>-1&&u.pop();for(var c=0;c<u.length;c++){var f=u[c],d=u[c+1],v=""==d||!isNaN(parseInt(d,10)),h=c===u.length-1;if(""===f){var a=u.slice(0,c).join();null==r[a]&&(r[a]=0),f=r[a]++}null==l[f]&&(l[f]=h?s:v?[]:{}),l=l[f]}}return n},buildQueryString$1=build,parseQueryString=parse,router$2=function(e){function t(e){d=e}function n(t){var n=e.location[t].replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent);return"pathname"===t&&"/"!==n[0]&&(n="/"+n),n}function r(e){return function(){null==l&&(l=f(function(){l=null,e()}))}}function i(e,t,n){var r=e.indexOf("?"),i=e.indexOf("#"),o=r>-1?r:i>-1?i:e.length;if(r>-1){var a=i>-1?i:e.length,s=parseQueryString(e.slice(r+1,a));for(var u in s)t[u]=s[u]}if(i>-1){var l=parseQueryString(e.slice(i+1));for(var u in l)n[u]=l[u]}return e.slice(0,o)}function o(){var e=d.charAt(0);switch(e){case"#":return n("hash").slice(d.length);case"?":return n("search").slice(d.length)+n("hash");default:return n("pathname").slice(d.length)+n("search")+n("hash")}}function a(t,n,r){var o={},a={};if(t=i(t,o,a),null!=n){for(var s in n)o[s]=n[s];t=t.replace(/:([^\/]+)/g,function(e,t){return delete o[t],n[t]})}var u=buildQueryString$1(o);u&&(t+="?"+u);var l=buildQueryString$1(a);l&&(t+="#"+l),c?(r&&r.replace?e.history.replaceState(null,null,d+t):e.history.pushState(null,null,d+t),e.onpopstate()):e.location.href=d+t}function s(t,n,a){function s(){var e=o(),r={},s=i(e,r,r);for(var u in t){var l=new RegExp("^"+u.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(l.test(s))return void s.replace(l,function(){for(var i=u.match(/:[^\/]+/g)||[],o=[].slice.call(arguments,1,-2),a=0;a<i.length;a++)r[i[a].replace(/:|\./g,"")]=decodeURIComponent(o[a]);n(t[u],r,e,u)})}a(e,r)}return c?e.onpopstate=r(s):"#"===d.charAt(0)&&(e.onhashchange=s),s(),s}function u(e){e.dom.setAttribute("href",d+e.attrs.href),e.dom.onclick=function(e){if(!(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault(),e.redraw=!1;var t=this.getAttribute("href");0===t.indexOf(d)&&(t=t.slice(d.length)),a(t,void 0,void 0)}}}var l,c="function"==typeof e.history.pushState,f="function"==typeof setImmediate?setImmediate:setTimeout,d="#!";return{setPrefix:t,getPath:o,setPath:a,defineRoutes:s,link:u}},Vnode$6=vnode,coreRouter=router$2,router=function(e,t){function n(e){return e}var r,i,o,a,s,u=coreRouter(e),l={view:function(){return[o(Vnode$6(i,null,a,void 0,void 0,void 0))]}},c=function(e,c,f){i="div",o=n,a=null,t(e,l),u.defineRoutes(f,function(t,u,l){var c="function"!=typeof t.view,f=n,d=r=function(n){d===r&&(r=null,i=null!=n?n:c?"div":t,o=f,a=u,s=l,e.redraw(!0))},v=function(){d()};c&&("function"==typeof t.render&&(f=t.render.bind(t)),"function"==typeof t.onmatch&&(v=t.onmatch)),v.call(t,d,u,l)},function(){u.setPath(c,null,{replace:!0})})};return c.link=u.link,c.prefix=u.setPrefix,c.set=u.setPath,c.get=function(){return s},c},mount$4=mount,route=router(window,mount$4),withAttr=function(e,t,n){return function(r){return t.call(n||this,e in r.currentTarget?r.currentTarget[e]:r.currentTarget.getAttribute(e))}},m=hyperscript_1,requestService=request,redrawService=redraw;requestService.setCompletionCallback(redrawService.publish),m.mount=mount,m.route=route,m.withAttr=withAttr,m.prop=stream,m.render=render.render,m.redraw=redrawService.publish,m.request=requestService.request,m.jsonp=requestService.jsonp,m.parseQueryString=parse,m.buildQueryString=build,m.version="bleeding-edge";var index=m,global=new Function("return this")(),Utils$1={extend:function(e,t){for(var n in t)e[n]=t[n];return e},createNonEnumerable:function(e,t){var n={};for(var r in e)n[r]={value:e[r]};return Object.create(t||{},n)},error:function(e){var t=new Error(e);if(console)return console.error(t);throw t},each:function(e,t){var n,r,i;if(e&&e.constructor==Array)for(n=0,r=e.length;n<r;n++)t(e[n],n);else for(i=Object.keys(e),n=0,r=i.length;n<r;n++)t(e[i[n]],i[n])},addNE:function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:t[n]})},createNE:function(e){var t={};for(var n in e)t[n]={writable:!0,configurable:!0,enumerable:!1,value:e[n]};return t},nextTick:function(){function e(){for(;n=r.shift();)n();i=!1}function t(e){r.push(e),i||(i=!0,s())}var n,r=[],i=!1,o=!!global.postMessage&&"undefined"!=typeof Window&&global instanceof Window,a="nexttick",s=function(){return o?function(){global.postMessage(a,"*")}:function(){setTimeout(function(){u()},0)}}(),u=function(){return o?function(t){t.source===global&&t.data===a&&(t.stopPropagation(),e())}:e}();return o&&global.addEventListener("message",u,!0),t.removeListener=function(){global.removeEventListener("message",u,!0)},t}(),findPivot:function(e){var t=this;if(e&&e.__){if(e.__.pivot)return e;for(var n,r=0,i=e.__.parents,o=0;!r&&o<i.length;)n=i[o],n.__.pivot&&(r=n),o++;if(r)return r;for(o=0;!r&&o<i.length;)r=t.findPivot(i[o]),o++;return r}},isLeaf:function(e,t){var n;return!e||!(n=e.constructor)||(t?n===String||n===Number||n===Boolean:n!=Object&&n!=Array)}},utils=Utils$1,Utils$2=utils,BEFOREALL="beforeAll",AFTERALL="afterAll",specialEvents=[BEFOREALL,AFTERALL],emitterProto={on:function(e,t,n){var r=this._events[e]||[];return r.push({callback:t,once:n}),this._events[e]=r,this},once:function(e,t){return this.on(e,t,!0)},off:function(e,t){if("undefined"==typeof e)this._events={};else if("undefined"==typeof t)this._events[e]=[];else{var n,r=this._events[e]||[];for(n=r.length-1;n>=0;n--)r[n].callback===t&&r.splice(n,1)}return this},trigger:function(e){var t,n,r,i,o=this,a=[].slice.call(arguments,1),s=this._events[e]||[],u=[],l=specialEvents.indexOf(e)!=-1;for(l||this.trigger.apply(this,[BEFOREALL,e].concat(a)),t=0;t<s.length;t++)n=s[t],n.callback?i=n.callback.apply(o,a):n.once=!0,n.once&&u.push(t),void 0!==i&&(r=i);for(t=u.length-1;t>=0;t--)s.splice(u[t],1);return l||this.trigger.apply(this,[AFTERALL,e].concat(a)),r}},Emitter$1=Utils$2.createNonEnumerable(emitterProto),emitter=Emitter$1,Utils$4=utils,nodeCreator$1={init:function(e){var t={set:function(e,t){var n=this,r=e,i=this.__.trans;if("object"!=typeof e&&(r={},r[e]=t),!i){for(var o in r)i=i||n[o]!==r[o];if(!i)return Utils$4.findPivot(this)||this}return this.__.store.notify("merge",this,r)},reset:function(e){return this.__.store.notify("replace",this,e)},getListener:function(){return e.createListener(this)},toJS:function(){var e;return e=this.constructor==Array?new Array(this.length):{},Utils$4.each(this,function(t,n){t&&t.__?e[n]=t.toJS():e[n]=t}),e},transact:function(){return this.__.store.notify("transact",this)},run:function(){return this.__.store.notify("run",this)},now:function(){return this.__.store.notify("now",this)},pivot:function(){return this.__.store.notify("pivot",this)}},n=Utils$4.extend({push:function(e){return this.append([e])},append:function(e){return e&&e.length?this.__.store.notify("splice",this,[this.length,0].concat(e)):this},pop:function(){return this.length?this.__.store.notify("splice",this,[this.length-1,1]):this},unshift:function(e){return this.prepend([e])},prepend:function(e){return e&&e.length?this.__.store.notify("splice",this,[0,0].concat(e)):this},shift:function(){return this.length?this.__.store.notify("splice",this,[0,1]):this},splice:function(e,t,n){return this.__.store.notify("splice",this,arguments)}},t),r=Object.create(Array.prototype,Utils$4.createNE(n)),i=Utils$4.createNE(Utils$4.extend({remove:function(e){var t=this,n=[],r=e;e.constructor!=Array&&(r=[e]);for(var i=0,o=r.length;i<o;i++)t.hasOwnProperty(r[i])&&n.push(r[i]);return n.length?this.__.store.notify("remove",this,n):this}},t)),o=Object.create(Object.prototype,i),a=function(){return[].__proto__?function(e){var t=new Array(e);return t.__proto__=r,t}:function(e){var t=new Array(e);for(var r in n)t[r]=n[r];return t}}();this.clone=function(e){var t=e.constructor;return t==Array?a(e.length):t===Object?Object.create(o):Object.create(t.prototype,i)}}},nodeCreator_1=nodeCreator$1,Utils$3=utils,nodeCreator=nodeCreator_1,Emitter$2=emitter,Frozen$1={freeze:function(e,t){if(e&&e.__)return e;var n=this,r=nodeCreator.clone(e);return Utils$3.addNE(r,{__:{listener:!1,parents:[],store:t}}),Utils$3.each(e,function(e,i){Utils$3.isLeaf(e,t.freezeInstances)||(e=n.freeze(e,t)),e&&e.__&&n.addParent(e,r),r[i]=e}),t.freezeFn(r),r},merge:function(e,t){var n=e.__,r=n.trans,t=Utils$3.extend({},t);if(r){for(var i in t)r[i]=t[i];return e}var o,a,s,u=this,l=this.copyMeta(e),c=n.store;Utils$3.each(e,function(n,r){return s=n&&n.__,s&&u.removeParent(n,e),(o=t[r])?(Utils$3.isLeaf(o,c.freezeInstances)||(o=u.freeze(o,c)),o&&o.__&&u.addParent(o,l),delete t[r],void(l[r]=o)):(s&&u.addParent(n,l),l[r]=n)});for(a in t)o=t[a],Utils$3.isLeaf(o,c.freezeInstances)||(o=u.freeze(o,c)),o&&o.__&&u.addParent(o,l),l[a]=o;return n.store.freezeFn(l),this.refreshParents(e,l),l},replace:function(e,t){var n=this,r=e.__,i=t;return Utils$3.isLeaf(t,r.store.freezeInstances)||(i=n.freeze(t,r.store),i.__.parents=r.parents,i.__.updateRoot=r.updateRoot,r.listener&&(i.__.listener=r.listener)),i&&this.fixChildren(i,e),this.refreshParents(e,i),i},remove:function(e,t){var n=e.__.trans;if(n){for(var r=t.length-1;r>=0;r--)delete n[t[r]];return e}var i,o=this,a=this.copyMeta(e);return Utils$3.each(e,function(n,r){i=n&&n.__,i&&o.removeParent(n,e),t.indexOf(r)==-1&&(i&&o.addParent(n,a),a[r]=n)}),e.__.store.freezeFn(a),this.refreshParents(e,a),a},splice:function(e,t){var n=this,r=e.__,i=r.trans;if(i)return i.splice.apply(i,t),e;var o,a=this,s=this.copyMeta(e),u=t[0],l=u+t[1];if(Utils$3.each(e,function(t,n){t&&t.__&&(a.removeParent(t,e),(n<u||n>=l)&&a.addParent(t,s)),s[n]=t}),t.length>1)for(var c=t.length-1;c>=2;c--)o=t[c],Utils$3.isLeaf(o,r.store.freezeInstances)||(o=n.freeze(o,r.store)),o&&o.__&&n.addParent(o,s),t[c]=o;return Array.prototype.splice.apply(s,t),r.store.freezeFn(s),this.refreshParents(e,s),s},transact:function(e){var t,n=this,r=e.__.trans;return r?r:(t=e.constructor==Array?[]:{},Utils$3.each(e,function(e,n){t[n]=e}),e.__.trans=t,Utils$3.nextTick(function(){e.__.trans&&n.run(e)}),t)},run:function(e){var t=this,n=e.__.trans;if(!n)return e;Utils$3.each(n,function(n,r){n&&n.__&&t.removeParent(n,e)}),delete e.__.trans;var r=this.replace(e,n);return r},pivot:function(e){return e.__.pivot=1,this.unpivot(e),e},unpivot:function(e){Utils$3.nextTick(function(){e.__.pivot=0})},refresh:function(e,t,n){var r=this,i=e.__.trans,o=0;if(i)return Utils$3.each(i,function(a,s){o||a===t&&(i[s]=n,o=1,n&&n.__&&r.addParent(n,e))}),e;var a,s=this.copyMeta(e);Utils$3.each(e,function(i,o){i===t&&(i=n),i&&(a=i.__)&&(r.removeParent(i,e),r.addParent(i,s)),s[o]=i}),e.__.store.freezeFn(s),this.refreshParents(e,s)},fixChildren:function(e,t){var n=this;Utils$3.each(e,function(r){if(r&&r.__){if(n.fixChildren(r),1==r.__.parents.length)return r.__.parents=[e];t&&n.removeParent(r,t),n.addParent(r,e)}})},copyMeta:function(e){var t=nodeCreator.clone(e),n=e.__;return Utils$3.addNE(t,{__:{store:n.store,updateRoot:n.updateRoot,listener:n.listener,parents:n.parents.slice(0),trans:n.trans,pivot:n.pivot}}),n.pivot&&this.unpivot(t),t},refreshParents:function(e,t){var n,r=this,i=e.__,o=i.parents.length;if(e.__.updateRoot&&e.__.updateRoot(e,t),t&&this.trigger(e,"update",t,i.store.live),o)for(n=o-1;n>=0;n--)r.refresh(i.parents[n],e,t)},removeParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r!=-1&&n.splice(r,1)},addParent:function(e,t){var n=e.__.parents,r=n.indexOf(t);r==-1&&(n[n.length]=t)},trigger:function(e,t,n,r){var i=e.__.listener;if(i){var o=i.ticking;if(r)return void((o||n)&&(i.ticking=0,i.trigger(t,o||n,e)));i.ticking=n,i.prevState||(i.prevState=e),o||Utils$3.nextTick(function(){if(i.ticking){var n=i.ticking;i.prevState;i.ticking=0,i.prevState=0,i.trigger(t,n,e)}})}},createListener:function(e){var t=e.__.listener;return t||(t=Object.create(Emitter$2,{_events:{value:{},writable:!0}}),e.__.listener=t),t}};nodeCreator.init(Frozen$1);var frozen=Frozen$1,Utils=utils,Frozen=frozen,Freezer$2=function(e,t){var n,r=this,i=t||{},o={
live:i.live||!1,freezeInstances:i.freezeInstances||!1},a=[],s=0,u=function(e){var t,n=e.__;if(n.listener){var r=n.listener.prevState||e;n.listener.prevState=0,Frozen.trigger(r,"update",e,!0)}for(t=0;t<n.parents.length;t++)n.store.notify("now",n.parents[t])},l=function(e){a.push(e),s||(s=1,Utils.nextTick(function(){a=[],s=0}))};o.notify=function(e,t,n){if("now"==e){if(a.length)for(;a.length;)u(a.shift());else u(t);return t}var r=Frozen[e](t,n);if("pivot"!=e){var i=Utils.findPivot(r);if(i)return l(r),i}return r},o.freezeFn=i.mutable===!0?function(){}:function(e){Object.freeze(e)},n=Frozen.freeze(e,o),n.__.updateRoot=function(e,t){e===n&&(n=t)};var c=n.getListener(),f={};Utils.each(["on","off","once","trigger"],function(e){var t={};t[e]=c[e].bind(c),Utils.addNE(r,t),Utils.addNE(f,t)}),Utils.addNE(this,{get:function(){return n},set:function(e){n.reset(e)},getEventHub:function(){return f}}),Utils.addNE(this,{getData:this.get,setData:this.set})},freezer$2=Freezer$2,Freezer=freezer$2,freezer$1=Freezer,State=new freezer$1({status:"loading",cart:{status:"ready",products:[]},products:[]}),ProductItem={view:function(e){var t=e.attrs.product,n=t.inventory>0;return index(".uk-panel.uk-panel-box.uk-margin-bottom",[index("img[src="+t.image+"]"),index("h4.uk-h4",t.title+" - $"+t.price),index("button.uk-button.uk-button-small.uk-button-primary",{disabled:n?"":"disabled",onclick:function(n){return e.attrs.onAddToCartClicked(t)}},n?"Add to Cart":"Sold Out")])}},ProductList={view:function(e){return index(".shop-wrap",[index("h2",e.attrs.title),index("div",e.attrs.children)])}},ProductsContainer={view:function(e){var t=this,n=e.attrs.products.map(function(e){return index(ProductItem,{key:e.id,product:e,onAddToCartClicked:t.onAddToCartClicked(e)})});return index(ProductList,{title:"Mithril Flux Shop Demo (Freezer)",children:n})},onAddToCartClicked:function(e){return function(){return State.trigger("products:add",e)}}},Product={view:function(e){return index("div",e.attrs.children)}},Cart={view:function(e){var t=e.attrs.products,n=t.length>0,r=n?t.map(function(e){return index(Product,{key:""+e.id,children:e.title+" - $"+e.price+" x "+e.quantity})}):index("div","Please add some products to cart.");return index(".cart.uk-panel.uk-panel-box.uk-panel-box-primary",[index(".uk-badge.uk-margin-bottom","Your Cart"),index(".uk-margin-small-bottom",r),index(".uk-margin-small-bottom","Total: $"+e.attrs.total),index("button.uk-button.uk-button-large.uk-button-success.uk-align-right",{disabled:n?"":"disabled",onclick:function(t){t.target.disabled=!0,e.attrs.onCheckoutClicked()}},"Checkout")])}},CartContainer={view:function(e){var t=e.attrs.cart,n=0;return t.products.map(function(e){return n+=e.price*e.quantity}),index(Cart,{products:t.products,total:n.toFixed(2),onCheckoutClicked:this.onCheckoutClicked(t.products)})},onCheckoutClicked:function(e){if(e.length)return function(){return State.trigger("products:checkout")}}},App={view:function(e){var t=State.get();return"loading"===t.status?index("div","Loading..."):index("div",[index(ProductsContainer,{products:t.products}),index(CartContainer,{cart:t.cart})])}},Api={getProducts:function(e){return index.request({method:"GET",url:"products.json"}).run(e)},buyProducts:function(e,t,n){void 0===n&&(n=500),setTimeout(function(){return t()},n)}};State.on("products:fetch",function(){State.get().set({status:"loading"}),Api.getProducts(function(e){State.get().set({products:e,status:"ready"})})}).on("products:checkout",function(){var e=State.get().cart.set({status:"checkingout"});Api.buyProducts(e.products,function(){console.log("YOU BOUGHT: ",e.products.toJS()),State.get().cart.set({status:"ready",products:[]})})}).on("products:add",function(e){var t,n=State.get().pivot();e.inventory>0&&(t=findInCart(n.cart,e.id),n=t?t.set({quantity:t.quantity+1}):n.cart.products.push({id:e.id,title:e.title,quantity:1,price:e.price}),e.set({inventory:e.inventory-1}))}).on("update",index.redraw),State.trigger("products:fetch"),index.mount(document.getElementById("appRoot"),App);
